<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Wei.Yz's Blog">
<meta property="og:url" content="http://weiYz.github.io/index.html">
<meta property="og:site_name" content="Wei.Yz's Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wei.Yz's Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://weiYz.github.io/"/>





  <title> Wei.Yz's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Wei.Yz's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://weiYz.github.io/2020/05/13/关于Synchronized的总结/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="wei.yz">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Wei.Yz's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Wei.Yz's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/13/关于Synchronized的总结/" itemprop="url">
                  关于Synchronized的总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-13T16:13:00+08:00">
                2020-05-13
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##synchronized</p>
<p>很多知识学过、用过但没有梳理出来，就很容易忘。synchronized 作为多线程中非常重要的知识点，需要认真理解。</p>
<p><strong>synchronized 可以用来修饰以下 3 个层面</strong>：</p>
<ol>
<li><p>修饰实例方法；</p>
</li>
<li><p>修饰静态类方法；</p>
</li>
<li><p>修饰代码块。</p>
</li>
</ol>
<hr>
<p>###synchronized 修饰实例方法</p>
<blockquote>
<p>这种情况下的<strong>锁对象是当前实例对象</strong>，因此只有同一个实例对象调用此方法才会产生互斥效果，不同实例对象之间不会有互斥效果。</p>
</blockquote>
<p>比如如下代码：</p>
<p><img src="/2020/05/13/关于Synchronized的总结/7.png" alt=""></p>
<p>上述代码，在不同的线程中调用的是不同对象的 printLog 方法，因此彼此之间不会有排斥。运行效果如下：</p>
<p><img src="/2020/05/13/关于Synchronized的总结/1.png" alt=""></p>
<p>可以看出，两个线程是乱序执行的。</p>
<hr>
<p>如果将代码进行如下修改，两个线程调用同一个对象的 printLog 方法：</p>
<p><img src="/2020/05/13/关于Synchronized的总结/4.png" alt=""></p>
<p>则执行效果如下：</p>
<p><img src="/2020/05/13/关于Synchronized的总结/3.png" alt=""></p>
<p>可以看出：只有某一个线程中的代码执行完之后，才会调用另一个线程中的代码。也就是说此时两个线程间是互斥的。</p>
<hr>
<p>###修饰静态类方法</p>
<blockquote>
<p>如果 synchronized 修饰的是静态方法，则<strong>锁对象是当前类的 Class 对象</strong>。因此即使在不同线程中调用不同实例对象，也会有互斥效果。</p>
</blockquote>
<p> 将 printLog 修改为静态方法，如下：</p>
<p><img src="/2020/05/13/关于Synchronized的总结/6.png" alt=""></p>
<p>执行后的打印效果如下：</p>
<p><img src="/2020/05/13/关于Synchronized的总结/3.png" alt=""></p>
<p>可以看出，两个线程还是依次执行的。</p>
<hr>
<p>###synchronized 修饰代码块</p>
<p>除了直接修饰方法之外，synchronized 还可以作用于代码块，比如DCL的单例模式，如下代码所示：</p>
<p><img src="/2020/05/13/关于Synchronized的总结/9.png" alt=""></p>
<blockquote>
<p>synchronized 作用于代码块时，锁对象就是跟在后面括号中的对象。上图中可以看出任何 Object 对象都可以当作锁对象。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://weiYz.github.io/2018/06/01/关于Looper的梳理/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="wei.yz">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Wei.Yz's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Wei.Yz's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/06/01/关于Looper的梳理/" itemprop="url">
                  关于Looper的梳理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-01T01:04:26+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Looper"><a href="#Looper" class="headerlink" title="Looper"></a>Looper</h3><p>当一个Activity被创建时，ActivityThread的<code>main()</code>方法会被执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public static void main(String[] args) &#123;</div><div class="line">    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, &quot;ActivityThreadMain&quot;);</div><div class="line">...</div><div class="line">	</div><div class="line">    Looper.prepareMainLooper();</div><div class="line">	</div><div class="line">...</div><div class="line">    Looper.loop();</div><div class="line"></div><div class="line">    throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>主线程Looper的创建是调用Looper的<code>prepareMainLooper()</code>方法来创建Looper对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public static void prepareMainLooper() &#123;</div><div class="line">    prepare(false);</div><div class="line">    synchronized (Looper.class) &#123;</div><div class="line">        if (sMainLooper != null) &#123;</div><div class="line">            throw new IllegalStateException(&quot;The main Looper has already been prepared.&quot;);</div><div class="line">        &#125;</div><div class="line">        sMainLooper = myLooper();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">private static void prepare(boolean quitAllowed) &#123;</div><div class="line">    if (sThreadLocal.get() != null) &#123;</div><div class="line">        throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);</div><div class="line">    &#125;</div><div class="line">    sThreadLocal.set(new Looper(quitAllowed));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里的sThreadLocal对象的类型是ThreadLocal<looper>是一个存放在TLS（Thread-local storage)中的对象容器，储存在其中的对象的特点是每个线程中只有一个，并且个线程中储存的该对象不相同。</looper></p>
<p>我们在这里新建了一个Looper对象并放入了TLS中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">private Looper(boolean quitAllowed) &#123;</div><div class="line">    mQueue = new MessageQueue(quitAllowed);</div><div class="line">    mThread = Thread.currentThread();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>mThread保存了当前运行Looper的进程信息, 而mQueue就是与Looper对应的MessageQueue。</p>
<p>问题：<br>一个线程只能有一个Looper，如何实现的呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">private static void prepare(boolean quitAllowed) &#123;</div><div class="line">    if (sThreadLocal.get() != null) &#123;</div><div class="line">        throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);</div><div class="line">    &#125;</div><div class="line">    sThreadLocal.set(new Looper(quitAllowed));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>prepare 重复调用会抛出异常！</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">public void set(T value) &#123;</div><div class="line">    Thread t = Thread.currentThread();</div><div class="line">    ThreadLocalMap map = getMap(t);</div><div class="line">    if (map != null)</div><div class="line">        map.set(this, value);</div><div class="line">    else</div><div class="line">        createMap(t, value);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<p>threadlocal正是用的thread对象本身来当key，这样每次在thread里创建一个looper时，系统都会先去全局的threadLocal里的hashmap看看对应的线程id里是否已经存了looper，如果没有，就说明这个线程还没有创建过looper，就正常创建，然后存进hashmap里。如果已经有了，就会报错。如此一来，每个线程就像在自己的环境里保存本地变量一样，互不干扰，这也就是Local的意思。同时，由于message queue是looper里的一个成员，looper是线程唯一的，所以message queue也是线程唯一的.</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://weiYz.github.io/2018/05/10/关于MessageQueue的梳理/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="wei.yz">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Wei.Yz's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Wei.Yz's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/05/10/关于MessageQueue的梳理/" itemprop="url">
                  关于MessageQueue的梳理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-10T19:04:42+08:00">
                2018-05-10
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="MessageQueue"><a href="#MessageQueue" class="headerlink" title="MessageQueue"></a>MessageQueue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MessageQueue(boolean quitAllowed) &#123;</div><div class="line">    mQuitAllowed = quitAllowed;</div><div class="line">    mPtr = nativeInit();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>构造函数十分简单，除了初始化quitAllowed标记之外，就是对mPtr的初始化了。</p>
<p>那么mPtr是什么呢？可以推测出的是，真正的MessageQueue的创建一定在nativeInit这个Native调用中，也就是说，我们的MessageQueue实际上存在于Native层。</p>
<p>android_os_MessageQueue.cpp:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">static jlong android_os_MessageQueue_nativeInit(JNIEnv* env, jclass clazz) &#123;</div><div class="line">    NativeMessageQueue* nativeMessageQueue = new NativeMessageQueue();</div><div class="line">    if (!nativeMessageQueue) &#123;</div><div class="line">        jniThrowRuntimeException(env, &quot;Unable to allocate native queue&quot;);</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    nativeMessageQueue-&gt;incStrong(env);</div><div class="line">    return reinterpret_cast&lt;jlong&gt;(nativeMessageQueue);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在Native层创建了一个NativeMessageQueue对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">NativeMessageQueue::NativeMessageQueue() :</div><div class="line">        mPollEnv(NULL), mPollObj(NULL), mExceptionObj(NULL) &#123;</div><div class="line">    mLooper = Looper::getForThread();</div><div class="line">    if (mLooper == NULL) &#123;</div><div class="line">        mLooper = new Looper(false);</div><div class="line">        Looper::setForThread(mLooper);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>它的返回值赋给了Java层MessageQueue的mPtr域：</p>
<p>最后一行就将创建的NativeMessageQueue对象的地址转换为一个Java long类型返回，之后调用Native方法的时候就会传入这个参数来找到这个MessageQueue。</p>
<p>初始化过程结束后，回到ActivityThread的main()函数，调用了<code>Looper.loop()</code>函数开始消息循环。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">public static void loop() &#123;</div><div class="line">    final Looper me = myLooper();</div><div class="line">...</div><div class="line">    final MessageQueue queue = me.mQueue;</div><div class="line">...</div><div class="line"></div><div class="line">    for (;;) &#123;</div><div class="line">        Message msg = queue.next(); // might block ，也就是说这里会阻塞</div><div class="line">        if (msg == null) &#123;</div><div class="line">            // No message indicates that the message queue is quitting.</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">...</div><div class="line">        try &#123;</div><div class="line">            msg.target.dispatchMessage(msg);</div><div class="line">        &#125; finally &#123;</div><div class="line">            if (traceTag != 0) &#123;</div><div class="line">                Trace.traceEnd(traceTag);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">...</div><div class="line">        msg.recycleUnchecked();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第7行开始了一个无限循环，循环的第一步就是从MessageQueue里面获取一条Message，后面有一个注释告诉我们这个调用可能会阻塞。</p>
<p>接下来检查获取到的msg是否为null，如果为null，那么将会直接退出<code>loop()</code>函数，对于Activity的主线程来说，这个情况只会发生在应用退出的时候。</p>
<p>下面就直接调用了Message的target的<code>dispatchMessage()</code>函数，在使用Handler来发送消息的时候，这个target指的就是Handler本身。</p>
<p>MessageQueue的<code>next()</code><br>这个函数过程比较长，所以分开来分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Message next() &#123;</div><div class="line">    final long ptr = mPtr;</div><div class="line">    if (ptr == 0) &#123;</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    int pendingIdleHandlerCount = -1; // -1 only during first iteration</div><div class="line">    int nextPollTimeoutMillis = 0;</div><div class="line">    for (;;) &#123;</div><div class="line">...</div><div class="line">        // 它的作用是阻塞，当有新的消息或达到超时后返回.</div><div class="line">        nativePollOnce(ptr, nextPollTimeoutMillis);</div></pre></td></tr></table></figure>
<p>第一部分是变量的初始化，如果MessageQueue的mPtr为0的话，说明NativeMessageQueue没有正确初始化，返回null结束消息循环。</p>
<p>下面定义了两个变量，第一个pendingIdleHandlerCount初始化为-1，它表示的是将要执行的空闲Handler数量，之后会用到。</p>
<p>第二个nextPollTimeoutMillis就是距下一条消息被处理需要等待的时间。</p>
<p><strong><code>nativePollOnce()</code>函数，它的作用是阻塞，当有新的消息或达到超时后返回。而这个核心的特性，完全是利用系统提供的epoll机制实现的这点非常重要。</strong></p>
<p>下面的过程，注意看注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">synchronized (this) &#123;</div><div class="line">    final long now = SystemClock.uptimeMillis(); // 获取当前时刻</div><div class="line">    Message prevMsg = null;</div><div class="line">    Message msg = mMessages; // Message是一个链表的结构，而mMessages相当于&quot;头指针&quot;</div><div class="line">    if (msg != null &amp;&amp; msg.target == null) &#123;</div><div class="line">       // 当message的target为null的时候，被认为是一个特殊的message，我们应当跳过这类message</div><div class="line">        do &#123;</div><div class="line">            prevMsg = msg;</div><div class="line">            msg = msg.next;</div><div class="line">        &#125; while (msg != null &amp;&amp; !msg.isAsynchronous());</div><div class="line">    &#125;</div><div class="line">    if (msg != null) &#123;</div><div class="line">        if (now &lt; msg.when) &#123;</div><div class="line">          // 当时间还没到message的执行时间时，更新nextPollTimeoutMillis</div><div class="line">            nextPollTimeoutMillis = (int) Math.min(msg.when - now, Integer.MAX_VALUE);</div><div class="line">        &#125; else &#123;</div><div class="line">            // message到时间，需要被处理</div><div class="line">            mBlocked = false; // 取消阻塞状态标记</div><div class="line">            // 从链表中取出表头的message</div><div class="line">            if (prevMsg != null) &#123;</div><div class="line">                prevMsg.next = msg.next;</div><div class="line">            &#125; else &#123;</div><div class="line">                mMessages = msg.next;</div><div class="line">            &#125;</div><div class="line">            msg.next = null;</div><div class="line">            if (DEBUG) Log.v(TAG, &quot;Returning message: &quot; + msg);</div><div class="line">            msg.markInUse(); // 标记使用状态</div><div class="line">            return msg; // 返回该message</div><div class="line">        &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">        // msg == null，没有消息</div><div class="line">        nextPollTimeoutMillis = -1; // 如果该值为-1，nativePullOnce()将会无限执行直到有新的消息通知</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 处理退出消息循环的请求，返回null退出消息循环</div><div class="line">    if (mQuitting) &#123;</div><div class="line">        dispose();</div><div class="line">        return null;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>这就是MessageQueue中获取Message的流程，需要注意的就是Message的链表结构，每次取首元素来进行处理。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://weiYz.github.io/2018/03/09/关于Handler知识的一些总结/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="wei.yz">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Wei.Yz's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Wei.Yz's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/09/关于Handler知识的一些总结/" itemprop="url">
                  关于Handler知识的一些总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-09T00:14:17+08:00">
                2018-03-09
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h3><p>构造Handler的构造方法中除了实现默认参数的相互调用外，有内容的有这么两个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public Handler(Callback callback, boolean async) &#123;</div><div class="line">    ...</div><div class="line">    mLooper = Looper.myLooper();</div><div class="line">    if (mLooper == null) &#123;</div><div class="line">        throw new RuntimeException(</div><div class="line">            &quot;Can&apos;t create handler inside thread that has not called Looper.prepare()&quot;);</div><div class="line">    &#125;</div><div class="line">    mQueue = mLooper.mQueue;</div><div class="line">    mCallback = callback;</div><div class="line">    mAsynchronous = async;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果传入的了callback，将会保存到mCallback域中，之后的消息处理中会看到。</p>
<p>如果没有传入loop参数，将会使用默认的Looper.myLooper()也就是之前提到过的本线程TLS中储存的Looper对象。mQueue消息队列就是从该Looper中获取的消息队列。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public Handler(Looper looper, Callback callback, boolean async) &#123;</div><div class="line">    mLooper = looper;</div><div class="line">    mQueue = looper.mQueue;</div><div class="line">    mCallback = callback;</div><div class="line">    mAsynchronous = async;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果传入了looper，那么将从它这里获取对应的消息队列对象，之后的消息就会放入这个队列中，这也是Handler实现跨线程通信的基础。</p>
<p>发送消息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public final boolean sendMessage(Message msg)</div><div class="line">&#123;</div><div class="line">    return sendMessageDelayed(msg, 0);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">public final boolean sendMessageDelayed(Message msg, long delayMillis)</div><div class="line">&#123;</div><div class="line">    if (delayMillis &lt; 0) &#123;</div><div class="line">        delayMillis = 0;</div><div class="line">    &#125;</div><div class="line">    return sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public boolean sendMessageAtTime(Message msg, long uptimeMillis) &#123;</div><div class="line">    MessageQueue queue = mQueue;</div><div class="line">    if (queue == null) &#123;</div><div class="line">        RuntimeException e = new RuntimeException(</div><div class="line">                this + &quot; sendMessageAtTime() called with no mQueue&quot;);</div><div class="line">        Log.w(&quot;Looper&quot;, e.getMessage(), e);</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line">    return enqueueMessage(queue, msg, uptimeMillis);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最终调用的是<code>sendMessageAtTime()</code>方法，发送在特定时刻处理的消息。</p>
<p>然后调用<code>enqueueMessage()</code>方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) &#123;</div><div class="line">    msg.target = this;</div><div class="line">    if (mAsynchronous) &#123;</div><div class="line">        msg.setAsynchronous(true);</div><div class="line">    &#125;</div><div class="line">    return queue.enqueueMessage(msg, uptimeMillis);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里的第2行中，将msg的target设置为this也就是这个Handler本身.</p>
<blockquote>
<p><strong>当此Handler持有外部类（如Activity）的引用时，Message也就间接的持有此引用，这就是导致Handler内存泄漏的根源</strong></p>
</blockquote>
<p>我们回想起消息循环中处理Message的调用：</p>
<p><code>msg.target.dispatchMessage(msg);</code></p>
<p>现在我们知道，Handler发送的消息被消息队列拿到后，会调用发送它的Handler的dispatchMessage()方法对它进行处理。<br>然后，调用了MessageQueue的<code>enqueueMessage()</code>方法来向消息队列中插入消息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">boolean enqueueMessage(Message msg, long when) &#123;</div><div class="line">    // 不允许没有target的Message，这种Message(barrier)只能由系统产生用于唤醒消息队列</div><div class="line">    if (msg.target == null) &#123;</div><div class="line">        throw new IllegalArgumentException(&quot;Message must have a target.&quot;);</div><div class="line">    &#125;</div><div class="line">    // 防止消息被重复处理</div><div class="line">    if (msg.isInUse()) &#123;</div><div class="line">        throw new IllegalStateException(msg + &quot; This message is already in use.&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    synchronized (this) &#123;</div><div class="line">        // 检查消息队列是否处于退出状态</div><div class="line">        if (mQuitting) &#123;</div><div class="line">            IllegalStateException e = new IllegalStateException(</div><div class="line">                    msg.target + &quot; sending message to a Handler on a dead thread&quot;);</div><div class="line">            Log.w(TAG, e.getMessage(), e);</div><div class="line">            msg.recycle();</div><div class="line">            return false;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        msg.markInUse();</div><div class="line">        msg.when = when;</div><div class="line">        Message p = mMessages;</div><div class="line">        boolean needWake;</div><div class="line">        if (p == null || when == 0 || when &lt; p.when) &#123;</div><div class="line">            // 在这三种情况下，这条消息被插入到了队列的头部，因此我们应唤醒消息队列</div><div class="line">            msg.next = p;</div><div class="line">            mMessages = msg;</div><div class="line">            needWake = mBlocked; // 如果处于阻塞状态，则需要进行唤醒</div><div class="line">        &#125; else &#123;</div><div class="line">            // 在队列中插入的消息，只有在target为空（barrier）并且设置为异步时，需要进行唤醒操作</div><div class="line">            needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous();</div><div class="line">            Message prev;</div><div class="line">            // 熟悉的链表插入操作</div><div class="line">            for (;;) &#123;</div><div class="line">                prev = p;</div><div class="line">                p = p.next;</div><div class="line">                if (p == null || when &lt; p.when) &#123;</div><div class="line">                    break；</div><div class="line">                &#125;</div><div class="line">                if (needWake &amp;&amp; p.isAsynchronous()) &#123;</div><div class="line">                    needWake = false; // 如果有消息不需要进行异步处理，则无需进行唤醒操作</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            // 插入到p结节之前</div><div class="line">            msg.next = p; </div><div class="line">            prev.next = msg;</div><div class="line">        &#125;</div><div class="line">        // 如果有needWake标记，则进行消息队列的唤醒操作</div><div class="line">        if (needWake) &#123;</div><div class="line">            nativeWake(mPtr);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>整个方法的流程在注释中进行了分析，这里主要就分为了两种情况，需要进行队列唤醒与无需进行队列唤醒的，如果需要队列唤醒操作（有needWake标记），则会在调用的最后调用nativeWake()方法进行native的唤醒操作。 我们只需要等待设置的时间到达，消息队列就会取出我们发送的消息并进行处理。</p>
<p><strong>消息的处理</strong></p>
<p>消息队列拿到消息后，调用<code>msg.target.dispatchMessage(msg)</code>进行消息的处理，从前文我们了解到，Handler发送的消息的target就是Handler自身，所以调用的就是它的<code>dispatchMessage()</code>方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public void dispatchMessage(Message msg) &#123;</div><div class="line">    if (msg.callback != null) &#123;</div><div class="line">        handleCallback(msg);</div><div class="line">    &#125; else &#123;</div><div class="line">        if (mCallback != null) &#123;</div><div class="line">            if (mCallback.handleMessage(msg)) &#123;</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        handleMessage(msg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个过程也比较经典，第2行if判断Message是否拥有自己的callback，如果有的话就调用<code>handleCallback()</code>来运行这个Runnable：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">private static void handleCallback(Message message) &#123;</div><div class="line">    message.callback.run();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果没有自带callback，第5行检查Handler是否自带callback，如果有的话就去执行这个callback，但是这里还有一点细节需要注意，如果这个方法返回了false，那么后面Handler自带的handlerMessage()方法同样会被执行，这里其实就是一个执行的优先级顺序的问题，一般情况下我们使用时只会传入callback或是重写Handler的<code>handleMessage()</code>方法，优先级也就是确保一个执行顺序的逻辑。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://weiYz.github.io/2017/02/10/Java价格中的逗号格式收集/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="wei.yz">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Wei.Yz's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Wei.Yz's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/10/Java价格中的逗号格式收集/" itemprop="url">
                  Java价格中的逗号格式收集
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-10T12:22:29+08:00">
                2017-02-10
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>记录一下 以备不时之需</p>
</blockquote>
<p><code>java.text.DecimalFormat</code>类就是专门对数字进行格式化的，通过对该类的应用，可以为要输出的数字加上单位，或者控制数字的精度；</p>
<p>用法：可以在DecimalFormat实例化时传递格式，也可通过对象调用applyPattern方法来实现设置格式。</p>
<p>代码演示如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">public static void main(String[] args) &#123;</div><div class="line"></div><div class="line">    DecimalFormat df = new DecimalFormat();</div><div class="line">    double data = 1234.56789;</div><div class="line">    System.out.println(&quot;格式化之前的数字: &quot; + data);</div><div class="line"></div><div class="line">    //定义要显示的数字的格式</div><div class="line">    String style = &quot;0.0&quot;;</div><div class="line">    df.applyPattern(style);// 将格式应用于格式化器</div><div class="line">    System.out.println(&quot;采用style: &quot; + style + &quot;格式化之后: &quot; + df.format(data));</div><div class="line"></div><div class="line">    //在格式后添加诸如单位等字符</div><div class="line">    style = &quot;00000.000 kg&quot;;</div><div class="line">    df.applyPattern(style);</div><div class="line">    System.out.println(&quot;采用style: &quot; + style + &quot;格式化之后: &quot; + df.format(data));</div><div class="line"></div><div class="line">    // 模式中的&quot;#&quot;表示如果该位存在字符，则显示字符，如果不存在，则不显示。</div><div class="line">    style = &quot;##000.000 kg&quot;;</div><div class="line">    df.applyPattern(style);</div><div class="line">    System.out.println(&quot;采用style: &quot; + style + &quot;格式化之后: &quot; + df.format(data));</div><div class="line"></div><div class="line">    // 模式中的&quot;-&quot;表示输出为负数，要放在最前面</div><div class="line">    style = &quot;-000.000&quot;;</div><div class="line">    df.applyPattern(style);</div><div class="line">    System.out.println(&quot;采用style: &quot; + style + &quot;格式化之后: &quot; + df.format(data));</div><div class="line"></div><div class="line">    // 模式中的&quot;,&quot;在数字中添加逗号，方便读数字</div><div class="line">    style = &quot;-0,000.0#&quot;;</div><div class="line">    df.applyPattern(style);</div><div class="line">    System.out.println(&quot;采用style: &quot; + style + &quot;格式化之后: &quot; + df.format(data));</div><div class="line"></div><div class="line">    //模式中的&quot;E&quot;表示输出为指数，&quot;E&quot;之前的字符串是底数的格式， &quot;E&quot;之后的是字符串是指数的格式</div><div class="line">    style = &quot;0.00E000&quot;;</div><div class="line">    df.applyPattern(style);</div><div class="line">    System.out.println(&quot;采用style: &quot; + style + &quot;格式化之后: &quot; + df.format(data));</div><div class="line"></div><div class="line"></div><div class="line">    //模式中的&quot;%&quot;表示乘以100并显示为百分数，要放在最后。</div><div class="line">    style = &quot;0.00%&quot;;</div><div class="line">    df.applyPattern(style);</div><div class="line">    System.out.println(&quot;采用style: &quot; + style + &quot;格式化之后: &quot; + df.format(data));</div><div class="line"></div><div class="line"></div><div class="line">    // 模式中的&quot;\u2030&quot;表示乘以1000并显示为千分数，要放在最后。</div><div class="line">    style = &quot;0.00\u2030&quot;;</div><div class="line">    //在构造函数中设置数字格式</div><div class="line">    DecimalFormat df1 = new DecimalFormat(style);</div><div class="line">    //df.applyPattern(style);</div><div class="line">    System.out.println(&quot;采用style: &quot; + style + &quot;格式化之后: &quot; + df1.format(data));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>程序运行结果为：<img src="/2017/02/10/Java价格中的逗号格式收集/1.png" alt=""></p>
<blockquote>
<p>注意：最后一个是千分符</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://weiYz.github.io/2016/12/01/TV版APP扫码登录方案/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="wei.yz">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Wei.Yz's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Wei.Yz's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/01/TV版APP扫码登录方案/" itemprop="url">
                  TV版APP扫码登录方案
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-01T12:08:39+08:00">
                2016-12-01
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p> 为渠哪得清如，为有源头活水来 </p>
</blockquote>
<h3 id="1-扫描登录"><a href="#1-扫描登录" class="headerlink" title="1. 扫描登录"></a>1. 扫描登录</h3><p><strong>目前遇到需要扫码有以下场景:</strong></p>
<ol>
<li><p>用微信、QQ或者微博进行三方登录；</p>
</li>
<li><p>UE要求: 智能电视上输入不方便，在手机页面输入更便利。</p>
</li>
</ol>
<p><strong>实现流程概述</strong>:</p>
<ol>
<li><p>APP端根据Guid注册推送标示（Account/TAG）；</p>
</li>
<li><p>登录时，APP端根据一定规则生成二维码，其中包含能标示此设备的Guid；</p>
</li>
<li><p>手机扫描二维码，根据业务场景需要选择第三方或者自身后台进行鉴权；</p>
</li>
<li><p>鉴权成功后，后台调用推送接口，推送到指定Guid的APP设备；</p>
</li>
<li><p>APP端收到此推送，执行登录成功逻辑（推荐使用EventBus,用于异步消息的跨线程处理）。</p>
</li>
</ol>
<h3 id="2-互踢"><a href="#2-互踢" class="headerlink" title="2. 互踢"></a>2. 互踢</h3><p><strong>自身账户体系要求同一账号只能在一个设备登录或指定数目设备同时登录</strong></p>
<blockquote>
<p>以优酷土豆为例，假设同一账号同时至多登录 3 台APP设备（可拓展至Web站和Wap站)。</p>
</blockquote>
<h4 id="后台需维护一张-userId–devicId–-token–state-的关系表"><a href="#后台需维护一张-userId–devicId–-token–state-的关系表" class="headerlink" title="后台需维护一张 userId–devicId–*token–state 的关系表"></a>后台需维护一张 userId–devicId–*token–state 的关系表</h4><ul>
<li>假设A账户调用登录接口，此时数据库deviceId的在线记录不足 3 条，则插入此记录；</li>
<li>假设A账户调用登录接口，但此时已经存在了 3 条deviceId的在线记录，需根据一定调度策略踢掉某一台设备，同时给此deviceId发送推送消息，并将在线状态state置false。被踢掉的APP若收到此推送则执行互踢逻辑；</li>
<li>假如A账户调用通用接口，后台根据请求参数的deviceId或token判断时候合法，若不在表的在线记录中，在通用返回结果中定义errCode。 被踢掉的设备下一次请求接口时执行互踢逻辑。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://weiYz.github.io/2016/11/21/Android开发中的几点小心得/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="wei.yz">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Wei.Yz's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Wei.Yz's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/21/Android开发中的几点小心得/" itemprop="url">
                  Android开发中的几点小心得
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-21T17:37:46+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>不积跬步无以至千里，不积小流无以成江河</p>
</blockquote>
<h3 id="通用篇"><a href="#通用篇" class="headerlink" title="通用篇"></a>通用篇</h3><ol>
<li><p>做之前先考虑那些可以公用，资源，layout，类，做一个结构、架构分析以加快开发，提升代码可复用度。</p>
</li>
<li><p>全部Activity可继承自BaseActivity，便于统一风格与处理公共事件，一处修改全局有效，并且注意控制Activity的代码量，保持主要逻辑清晰。</p>
</li>
<li><p>与Activity通讯使用Handler更方便； 如果你的框架回调链变长，考虑监听者模式简化回调。 监听者模式不方便使用时，推荐EventBus框架库，使用时间总线。</p>
</li>
<li><p>全局变量放全局类中，模块私有放自己的管理类中，让常量清晰且集。其他类遵守SRP（单一职能），ISP（接口隔离）原则。</p>
</li>
<li><p>Log请打上Tag，调试打印一定要做标记，能定位打印位置，否则尴尬是：不知道是哪里在打印。</p>
</li>
<li><p>异常抛出，在合适的位置处理或者集中处理，不要搞的到处是catch，混乱且性能低，尽量不要在循环体中捕获异常，以提升性能。</p>
</li>
<li><p>构造函数里面极度不推荐启动异步线程，会埋下隐患。</p>
</li>
<li><p>千万不要理所当然的以为一个对象不会为空，充分的做好容错处理。</p>
</li>
<li><p>服务器和客户端尽量统一唯一标识（有可能是ID），否则多少会有歧义和问题。</p>
</li>
<li><p>如果数据没有必要加载，数据请务必延迟初始化，谨记为用户节省内存，总不会有坏处</p>
</li>
<li><p>注释，尽量去写足够的注释，去描述一下思路，达到看了可以明白某一块代码的效果。</p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://weiYz.github.io/2016/02/01/Android开发中View事件分发/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="wei.yz">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Wei.Yz's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Wei.Yz's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/01/Android开发中View事件分发/" itemprop="url">
                  Android开发中View事件分发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-02-01T11:30:49+08:00">
                2016-02-01
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p> 黑发不知勤学早 白首方悔读书迟</p>
</blockquote>
<p>Android的View事件分发是个老生常谈的问题，网上很多讲解和教程，但是在《Android开发艺术探索》中看到这一段伪代码，觉得非常之精辟，特记录下来：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span></span>&#123;</div><div class="line">    <span class="keyword">boolean</span> consume=<span class="keyword">false</span>;</div><div class="line">    <span class="keyword">if</span>(onInterceptTouchEvent(ev))&#123;</div><div class="line">         consume=onTouchEvent(ev);      </div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">         consume=child.dispatchTouchEvent(ev);    </div><div class="line">    &#125; </div><div class="line">    <span class="keyword">return</span> consume;     </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>几个比较重要的结论也一并摘录：</p>
</blockquote>
<ol>
<li><p>当一个点击事件产生后，它的传递过程遵循如下顺序：Activity->Window->View,即事件总是先传递给Activity，Activity在传递给Window，最后Window在传递给顶级View。顶级View接收到事件后，就会按照事件分发机制去分发事件。考虑一种情况，如果一个View的onTouchEvent返回false，那么它的父容器的onTouchEvent将会被调用，依此类推。如果所用的元素都不处理这个事件，那么这个事件将会最终传递给Activity处理，即Activity的onTouchEvent方法被调用。</p>
</li>
<li><p>正常情况下，一个事件序列只能被一个View拦截且消耗，因为一旦一个元素拦截了某个事件，那么同一个事件序列内的所有事件都会直接交给它处理，因此同一个事件序列中的事件不能分别有两个View同时处理，但是通过特殊手段可以做到，比如一个View将本该自己处理的事件通过onTouchEvent强行传递给其他View处理。</p>
</li>
<li><p>某个View一旦决定拦截，那么这一个事件序列都只能由它处理，并且它的onInterceptTouchEvent不会再被调用。</p>
</li>
<li><p>某个View一旦开始处理事件，如果它不消耗ACTION_DOWN事件（onTouchEvent返回了false），那么同一事件序列中的其他事件都不会再交给它处理，并且事件将重新交由它的父元素去处理，即父元素的onTouchEvent会被调用。意思就是事件一旦交给一个View处理，那么它就必须消耗掉，否则同一事件序列中剩下的事件就不再交给它来处理了。</p>
</li>
<li><p>如果View不消耗出ACTION_DOWN以外的其他事件，那么这个点击事件会消失，最终这些消失的点击事件会传递给Activity处理。</p>
</li>
<li><p>ViewGroup默认不拦截任何事件。</p>
</li>
<li><p>View没有onInterceptTouchEvent方法，一旦有事件传递给它，那么它的onTouchEvent方法就会被调用。</p>
</li>
<li><p>View的OnTouchEvent方法默认都会消耗事件（返回true）。</p>
</li>
<li><p>View的enable属性不影响onTouchEvent的默认返回值。</p>
</li>
<li><p>onClick会发生的前提是当前View是可点击的，并且它收到了down和up的事件。</p>
</li>
<li><p>事件的传递过程是由外向内的，即事件总是项传递给父元素，然后再由父元素分发给子View，通过requestDisallowInterceptTouchEvent方法可以在子元素中干预父元素的事件分发过程，但是ACTION_DOWN事件除外。(requestDisallowInterceptTouchEvent方法主要设置父元素中的FLAG_DISALLOW_INTERCEPT标记位，一旦设置后，ViewGroup将无法拦截除了ACTION_DOWN以外的其他点击事件）</p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://weiYz.github.io/2015/12/05/Mac上JNI开发遇到的问题总结/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="wei.yz">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Wei.Yz's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Wei.Yz's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/05/Mac上JNI开发遇到的问题总结/" itemprop="url">
                  Mac上JNI开发遇到的问题总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-05T15:15:51+08:00">
                2015-12-05
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="AndroidStudio-Mac-和-Eclipse-Windows的真是区别巨大。"><a href="#AndroidStudio-Mac-和-Eclipse-Windows的真是区别巨大。" class="headerlink" title="AndroidStudio+Mac 和 Eclipse+Windows的真是区别巨大。"></a>AndroidStudio+Mac 和 Eclipse+Windows的真是区别巨大。</h3><h4 id="1-—-gt-“Java-找不到类名”"><a href="#1-—-gt-“Java-找不到类名”" class="headerlink" title="1 —&gt; “Java 找不到类名”"></a>1 —&gt; “Java 找不到类名”</h4><p>带包名的，需要在包名最上层的目录执行。<br>例如你的类在xxx/demo(包名)/HelloWorld(类名),<br>然后在xxx/目录下执行javah -jni demo.HelloWorld，在xxx/目录下就会生成.h文件</p>
<p> <img src="/2015/12/05/Mac上JNI开发遇到的问题总结/jni_1.png" alt=""><br>在MAC Android Studio中  “classpath”  为“从当前目录到包名最上层目录” 的路径</p>
<p><img src="/2015/12/05/Mac上JNI开发遇到的问题总结/jni_2.png" alt=""></p>
<h4 id="2-—-gt-“java-lang-UnsatisfiedLinkError-Native-method-not-found”；"><a href="#2-—-gt-“java-lang-UnsatisfiedLinkError-Native-method-not-found”；" class="headerlink" title="2 —&gt; “java.lang.UnsatisfiedLinkError: Native method not found”；"></a>2 —&gt; “java.lang.UnsatisfiedLinkError: Native method not found”；</h4><p>1、c++中的方法Java_xxx_xxx 中的Java首字母一定要大写,注意格式不要写错。</p>
<p>2、如果是 .cpp 文件 则用 extern “C” {“您的方法在这里”}，大括号里是您的本地方法。</p>
<h4 id="3-—-gt-“java-lang-UnsatisfiedLinkError-couldn’t-find-“libXXX-so”"><a href="#3-—-gt-“java-lang-UnsatisfiedLinkError-couldn’t-find-“libXXX-so”" class="headerlink" title="3 —&gt;“java.lang.UnsatisfiedLinkError:couldn’t find “libXXX.so”"></a>3 —&gt;“java.lang.UnsatisfiedLinkError:couldn’t find “libXXX.so”</h4><p>这个问题是因为运行时没有load到指定的so库，检查拼写、路径和gradle配置。</p>
<p>在AndroidStudio中 “android{} ”标签中的“defaultConfig”标签中加入 “NDK”设置<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">defaultConfig &#123;</div><div class="line">    applicationId <span class="string">"wei.jni2"</span></div><div class="line">    minSdkVersion <span class="number">15</span></div><div class="line">    targetSdkVersion <span class="number">21</span></div><div class="line">    versionCode <span class="number">1</span></div><div class="line">    versionName <span class="string">"1.0"</span></div><div class="line">    ndk &#123;</div><div class="line">        moduleName <span class="string">"cLib"</span> <span class="comment">// &lt;-- This is the name of my C++ module!</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="4-—-gt-“Type-‘JNICALL’-could-not-be-resolved”"><a href="#4-—-gt-“Type-‘JNICALL’-could-not-be-resolved”" class="headerlink" title="4 —&gt; “Type ‘JNICALL’ could not be resolved”"></a>4 —&gt; “Type ‘JNICALL’ could not be resolved”</h4><ol>
<li>Project Properties -&gt; C/C++ General -&gt; Path and Symbols</li>
<li>选择include标签，Add -&gt; $Android_NDK_HOME/platforms/android-14/arch-arm/usr/include</li>
<li>选中All languages.</li>
<li>最后Apply -&gt; OK</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://weiYz.github.io/2015/12/05/Android搭建框架细节处理/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="wei.yz">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Wei.Yz's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Wei.Yz's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/05/Android搭建框架细节处理/" itemprop="url">
                  Android搭建框架细节处理.md
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-05T14:33:28+08:00">
                2015-12-05
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>总结了在新项目开发中遇到的一些需要注意的细节</p>
</blockquote>
<h4 id="新建一个团队项目需要注意哪些细节？"><a href="#新建一个团队项目需要注意哪些细节？" class="headerlink" title="新建一个团队项目需要注意哪些细节？"></a>新建一个团队项目需要注意哪些细节？</h4><ol>
<li>确定三方框架选择，统计分析、分享、推送等；</li>
<li>创建基类及抽象方法，如BaseActivity,BaseFragment,BaseAdapter等;</li>
<li>创建统一风格Dialog&amp;Alert模板、Loading动画、转场动画;</li>
<li>创建统一封装网络请求、图片加载、SP操作、SQLite操作、Toast显示等；</li>
<li>自定APP继承Application, 统一系统常量、统一网络请求地址；</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="wei.yz" />
          <p class="site-author-name" itemprop="name">wei.yz</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">11</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wei.yz</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


</body>
</html>
